#jQuery ->
#(($) ->
#$ ->
#$(document).ready ->

attachConversationHandler = ->
  $(".conversation-scroll").on 'scroll', ->
    more_posts_url = $(".pagination a[rel=next]").attr('href')
    if more_posts_url && $(".conversation-scroll").scrollTop() == 0
      $('.load-more').show()
      $('.load-more').html('<img src="<%= asset_path("ajax-loader.gif")%>" alt="Loading..." title="Loading..." />')
      setTimeout (->
        $.getScript more_posts_url
        return
      ), 500
    return
  return
#) jQuery

$(document).ready attachConversationHandler
$(document).on "page:load", attachConversationHandler
